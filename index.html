<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Facebook Search Builder</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <script>
    // Base64 encoding helper
    function encodeBase64(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    function openSearch() {
      const keyword = document.getElementById("keyword").value.trim();
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;

      if (!keyword) {
        alert("Please enter a keyword.");
        return;
      }
      if (!startDate || !endDate) {
        alert("Please select both start and end dates.");
        return;
      }

      // Extract parts of the dates
      const start = new Date(startDate);
      const end = new Date(endDate);

      const startYear = start.getFullYear().toString();
      const startMonth = `${start.getFullYear()}-${String(start.getMonth() + 1).padStart(2, "0")}`;
      const startDay = start.toISOString().split("T")[0];

      const endYear = end.getFullYear().toString();
      const endMonth = `${end.getFullYear()}-${String(end.getMonth() + 1).padStart(2, "0")}`;
      const endDay = end.toISOString().split("T")[0];

      // Build the data object dynamically
      const data = {
        "rp_creation_time": JSON.stringify({
          name: "creation_time",
          args: JSON.stringify({
            start_year: startYear,
            start_month: startMonth,
            end_year: endYear,
            end_month: endMonth,
            start_day: startDay,
            end_day: endDay
          })
        })
      };

      console.log(data);

      // Convert data to JSON string and encode
      const filterEncoded = encodeBase64(JSON.stringify(data));

      // Build URL
      const url = `https://www.facebook.com/search/posts?q=${encodeURIComponent(keyword)}&filters=${encodeURIComponent(filterEncoded)}`;

      // Open in new tab
      window.open(url, "_blank");
    }
  </script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title mb-4">Facebook Search Builder</h2>
        
        <div class="mb-3">
          <label for="keyword" class="form-label">Keyword</label>
          <input type="text" id="keyword" class="form-control" placeholder="Type a keyword">
        </div>

        <div class="mb-3">
          <label for="startDate" class="form-label">Start Date</label>
          <input type="date" id="startDate" class="form-control">
        </div>

        <div class="mb-3">
          <label for="endDate" class="form-label">End Date</label>
          <input type="date" id="endDate" class="form-control">
        </div>

        <button onclick="openSearch()" class="btn btn-primary">Search</button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (optional, for components like modals/tooltips) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
